env:
  matrix:
  - APP_ENV=test BUNDLER_VERSION=2.1.4
  global:
  - secure: iTB2/IWC/jpHJtEg75S1hlg09jPrf+YsBGKbo7x4v+gZcQWWYoDbzDpE6v0GlqrB4ENPw6KBEjq9NwBERDLMGAJDSnfON0LNe3WPBcCVpiBQQRMqKLg4RwY/2nTZfsCcEB3sfndyu82BhX0jcdLRd3JD7WAgtrA2z5dLQMgYieAVmalTb5CaJX/8wd4iyyraSxoPjjhEcUnvMRjyf7Dw223NpfkV0aEIajtaZnjrtFTIwbYD1w4oorVcdN/q5tH8xeMI1AEvtMbal0urReQHnW5GLZjxYx35MI0LyX7Ev9jsO+uSn4/vAyuJOH3KzeWCNnUxVuL0vSC2YCsfmxvQaMYd1C6CfjAOguVC6d6WnZlWmrMrabFXwC49k1ulvAz2N6Egjb5TvrMAD/Cz4YV9DA5/sP+a87x3Dmir+A7FL6fK0Cf0X+/24TAmwHC35F5/rq0eWcFTz6taNwEbi2LjgEG78PgSERyiP/ImBb4+qKhysuLDECJJlOXgTXdv65kazjA/pZZyidHWxNFLJNmb5H0aOvICq7ucRFENgtstivwSrdLOYQWVsgKOsBjeFgeE0bPBJD69++0nNtWZnQP/P3WUlDm5J2b01/61Q5cyI/yvLetJSxubENaXkd7xRw13G/4MdVFR9dtnWA1QEk0hAcGeW2rN7v3gSdQoy+pZsyQ=
  - secure: VErO3Yf6R5/+ZXkzWtIUVdW24b8pZrt7uZDdYGOcPb909RXnJ/DgmHNHPzB3NBgBh0C2DvaR1IEWVfXGSQYeHWY7K51nhBxJaasatBVq/nOiNG9eHvCfEIW8BX6zP+TvobemCd5jHLqHgl9H/bgKXjcTk2/vQ4UT1W2hYR4jSU1sBrtkfCSkw3ms2Or2M25YgKUZIR+Bi5hUg/ZdMoeoZvlK9za1xDhl1NkP37wnfC7ChOLT1+65UhQG/Eh/s2R8e2POaDpSFcnE0W/PBjIJ38vDGMS/AmrWlzMlDlqLlRswXR3DM7JYWkfRtqSO/uqTtf7GAJa45GgZulbOGfcigXdPsalcnH3BMcng/FQTAsmaECgeck+/W0/ceCIYduOpdATWKjaj/xwx2znM5seG0v0rs9yNP+u8LwBGuXfUkQtWfD4IviXhHDUBl1AMS/S7bYs/fkDaijmZaY8LTHKx6NFS6OO71az4vwwyMYVNKfmMUJ2JktGI6CI93Q78u0saPhBFCusQyneSnhAs3gtVOs0sDwMUr2CKeWtIBHuKncW3Ty1shiQpCBXrXoxYjiolQ4pdsMjkqAn0oDTs0XMvArE53xYPUAl8rBuiSRLcmH3eLU7+5Sm8/pbABvPjwgEtbMq+Nxh9q20HGZapgzLC5ZAPNlntae4cdT7KAw06V5o=
language: ruby
cache: bundler
rvm:
- 2.6.6
services:
- docker
before_install:
- gem install bundler -v $BUNDLER_VERSION
bundler_args: "--jobs=3 --retry=3"
stages:
- test
- build
jobs:
  include:
  - stage: test
    name: RSpec
    before_script:
    - echo $MY_SECRET_ENV
    - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
      > ./cc-test-reporter
    - chmod +x ./cc-test-reporter
    - "./cc-test-reporter before-build"
    - bundle exec devup up
    script:
    - bundle exec rspec
    after_success:
    - "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
  - stage: test
    name: Lint
    script:
    - bundle exec standardrb
  - stage: test
    name: Docker Image
    before_script:
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USER" --password-stdin
    script:
    - docker build .
